<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="nav.css">
    <link rel="stylesheet" href="game.css">
    <link rel="stylesheet" href="popup.css">
    <link rel="stylesheet" href="checkbox.css">

    <link rel="icon" href="controller.svg" type="image/x-icon">

    <script src="verben.js"></script>
    <script src="script.js"></script>
    <script src="popup.js"></script>

    <title>Jeu</title>
</head>

<body style="overflow: hidden;">
    <nav>
        <div class="pie pie1 active" onclick="window.location.href='game.html'">
            <svg class="controller" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" width="100" height="100">
                <path
                    d="M63.35,33.94c0,0-2.08-17.28-12.13-16.54c0,0-4.43-0.19-7.14,3.77c-0.73,1.07-1.92,1.74-3.22,1.74h-5.2l-0.38-2.15
            c-0.08-0.48-0.5-0.83-0.99-0.83h-1.5v-2.69c0-1.49,1.21-2.7,2.7-2.7c2.37,0,4.3-1.93,4.3-4.3V6.56c0-0.44-0.36-0.8-0.8-0.8
            c-0.44,0-0.8,0.36-0.8,0.8v3.69c0,1.49-1.21,2.7-2.7,2.7c-2.37,0-4.3,1.93-4.3,4.3v2.69h-1.5c-0.49,0-0.9,0.35-0.98,0.83
            l-0.38,2.15h-5.2c-1.3,0-2.49-0.67-3.22-1.74c-2.71-3.97-7.14-3.77-7.14-3.77C2.73,16.66,0.65,33.94,0.65,33.94
            s-3.19,20.83,4.53,23.89c5.82,2.31,10.32-5.63,12.18-9.67c0.68-1.47,1.96-2.58,3.52-3c7.41-1.99,14.82-1.99,22.22,0
            c1.56,0.42,2.85,1.53,3.52,3c1.86,4.04,6.36,11.98,12.18,9.67C66.53,54.77,63.35,33.94,63.35,33.94z M20.36,35.75h-4.88v4.88h-3.35
            v-4.88H7.25V32.4h4.88v-4.88h3.35v4.88h4.88V35.75z M28.86,29.83H25v-2.23h3.86V29.83z M39,29.83h-3.86v-2.23H39V29.83z
             M44.93,36.06c-1.17,0-2.12-0.95-2.12-2.12c0-1.17,0.95-2.12,2.12-2.12c1.17,0,2.12,0.95,2.12,2.12
            C47.06,35.11,46.11,36.06,44.93,36.06z M49.78,40.9c-1.17,0-2.12-0.95-2.12-2.12c0-1.17,0.95-2.12,2.12-2.12
            c1.17,0,2.12,0.95,2.12,2.12C51.9,39.95,50.95,40.9,49.78,40.9z M49.78,31.21c-1.17,0-2.12-0.95-2.12-2.12
            c0-1.17,0.95-2.12,2.12-2.12c1.17,0,2.12,0.95,2.12,2.12C51.9,30.26,50.95,31.21,49.78,31.21z M54.63,36.06
            c-1.17,0-2.12-0.95-2.12-2.12c0-1.17,0.95-2.12,2.12-2.12c1.17,0,2.12,0.95,2.12,2.12C56.75,35.11,55.8,36.06,54.63,36.06z" />
            </svg>
        </div>
        <div class="pie pie2" onclick="window.location.href='quiz.html'">
            <svg class="magnifying-glass" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100"
                height="100">
                <path d="M41,20c0,1.657-1.342,3-3,3c-8.271,0-15,6.729-15,15c0,1.657-1.342,3-3,3s-3-1.343-3-3
                c0-11.58,9.422-21,21-21C39.658,17,41,18.343,41,20z M95,80c0,8.271-6.729,15-15,15c-0.797,0-1.559-0.316-2.121-0.879l-18-18
                C59.316,75.559,59,74.795,59,74c0-3.052,0.927-5.887,2.499-8.259l-2.398-2.398C53.376,68.118,46.02,71,38,71
                C19.804,71,5,56.196,5,38S19.804,5,38,5s33,14.804,33,33c0,8.02-2.881,15.376-7.656,21.101l2.398,2.398
                C68.113,59.927,70.948,59,74,59c0.797,0,1.559,0.316,2.121,0.879l18,18C94.684,78.441,95,79.205,95,80z M38,65
                c14.889,0,27-12.113,27-27S52.889,11,38,11S11,23.113,11,38S23.111,65,38,65z M88.924,81.167l-16.09-16.093
                c-4.031,0.524-7.233,3.727-7.758,7.758l16.09,16.093C85.197,88.401,88.399,85.199,88.924,81.167z" />
            </svg>
        </div>
        <div class="pie pie3" onclick="window.location.href='lexique.html'">
            <div class="pie-color">
                <svg class="book" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="100" height="100">
                    <path
                        d="M20 22V2H7a3 3 0 0 0-3 3v14a3 3 0 0 0 3 3ZM8 6h8v2H8ZM6 19a1 1 0 0 1 .31-.71A.93.93 0 0 1 7 18h11v2H7a1 1 0 0 1-1-1Z" />
                </svg>
            </div>
        </div>
        <div class="menu" onclick="document.body.classList.toggle('active')">
            <svg class="hamburger" xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100">
                <g fill="none" stroke="#000" stroke-width="7.999" stroke-linecap="round">
                    <path d="M 55,26.000284 L 24.056276,25.999716" />
                    <path d="M 24.056276,49.999716 L 75.943724,50.000284" />
                    <path d="M 45,73.999716 L 75.943724,74.000284" />
                    <path d="M 75.943724,26.000284 L 45,25.999716" />
                    <path d="M 24.056276,73.999716 L 55,74.000284" />
                </g>
            </svg>
        </div>
    </nav>

    <div id="game-container">
        <p id="timer">Zeit: 0s</p>
    </div>

    <input type="text" name="answer" id="answer" placeholder="Antwort eingeben" autocomplete="off" oninput="check()"
        autofocus>

    <div id="popup">
        <p id="content"></p>
        <button id="close" onclick="hidePopup()">X</button>
        <button onclick="startGame()" id="popupButton">Nochmals spielen</button>
        <button id="settings" onclick="showMenu()">
            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="none" viewBox="0 0 16 16" id="settings">
                <path fill="#000"
                    d="M2.26726 6.15309C2.52898 5.34715 2.96011 4.60735 3.52898 3.98039C3.62517 3.87437 3.77609 3.83658 3.91121 3.88469L5.27069 4.36869C5.63926 4.49984 6.04482 4.30865 6.17653 3.94166C6.18948 3.90557 6.19946 3.8685 6.20635 3.83086L6.46535 2.41533C6.4911 2.27459 6.59966 2.16326 6.74019 2.13347C7.15137 2.04633 7.57295 2.00201 8.00006 2.00201C8.42691 2.00201 8.84824 2.04628 9.25918 2.13331C9.39967 2.16307 9.50822 2.27433 9.53403 2.41502L9.79376 3.8308C9.86398 4.21419 10.233 4.46831 10.6181 4.3984C10.656 4.39152 10.6932 4.38159 10.7294 4.36871L12.0889 3.88469C12.224 3.83658 12.3749 3.87437 12.4711 3.98039C13.04 4.60735 13.4711 5.34715 13.7329 6.15309C13.777 6.28905 13.7344 6.43811 13.625 6.53059L12.5231 7.46211C12.2248 7.71436 12.1883 8.15967 12.4416 8.45674C12.4665 8.48595 12.4938 8.51309 12.5231 8.53788L13.625 9.46941C13.7344 9.56189 13.777 9.71095 13.7329 9.84692C13.4711 10.6529 13.04 11.3927 12.4711 12.0196C12.3749 12.1256 12.224 12.1634 12.0889 12.1153L10.7294 11.6313C10.3609 11.5002 9.9553 11.6914 9.82359 12.0583C9.81064 12.0944 9.80066 12.1315 9.79374 12.1693L9.53403 13.585C9.50822 13.7257 9.39967 13.8369 9.25918 13.8667C8.84824 13.9537 8.42691 13.998 8.00006 13.998C7.57295 13.998 7.15137 13.9537 6.74019 13.8665C6.59966 13.8367 6.4911 13.7254 6.46535 13.5847L6.20636 12.1692C6.13614 11.7858 5.76708 11.5317 5.38203 11.6016C5.34416 11.6085 5.30693 11.6184 5.27075 11.6313L3.91121 12.1153C3.77609 12.1634 3.62517 12.1256 3.52898 12.0196C2.96011 11.3927 2.52898 10.6529 2.26726 9.84692C2.22311 9.71095 2.26568 9.56189 2.37509 9.46941L3.47699 8.53789C3.77534 8.28564 3.81183 7.84033 3.5585 7.54326C3.53359 7.51405 3.50633 7.48691 3.477 7.46212L2.37509 6.53059C2.26568 6.43811 2.22311 6.28905 2.26726 6.15309ZM6.24994 7.99994C6.24994 8.96644 7.03344 9.74994 7.99994 9.74994C8.96644 9.74994 9.74994 8.96644 9.74994 7.99994C9.74994 7.03344 8.96644 6.24994 7.99994 6.24994C7.03344 6.24994 6.24994 7.03344 6.24994 7.99994Z">
                </path>
            </svg>
        </button>
    </div>

    <div id="background"></div>

    <div id="menu">
        <h2>Zeitformen</h2>

        <label class="time-options">
            <input type="checkbox" id="present">
            <span class="checkmark"></span>
            Present
        </label>

        <label class="time-options">
            <input type="checkbox" id="conditionnel_present">
            <span class="checkmark"></span>
            Conditionnel Present
        </label>

        <label class="time-options">
            <input type="checkbox" id="conditionnel_passe">
            <span class="checkmark"></span>
            Conditionnel Passé
        </label>

        <label class="time-options">
            <input type="checkbox" id="passe_compose">
            <span class="checkmark"></span>
            Passé Compose
        </label>

        <label class="time-options">
            <input type="checkbox" id="imparfait">
            <span class="checkmark"></span>
            Imparfait
        </label>

        <label class="time-options">
            <input type="checkbox" id="plus_que_parfait">
            <span class="checkmark"></span>
            Plus-que-parfait
        </label>

        <label class="time-options">
            <input type="checkbox" id="futur_simple">
            <span class="checkmark"></span>
            Futur simple
        </label>

        <label class="time-options">
            <input type="checkbox" id="futur_proche">
            <span class="checkmark"></span>
            Futur proche
        </label>

        <label class="time-options">
            <input type="checkbox" id="futur_anterieur">
            <span class="checkmark"></span>
            Futur antérieur
        </label>

        <label class="time-options">
            <input type="checkbox" id="imperatif">
            <span class="checkmark"></span>
            Impératif
        </label>

        <label class="time-options">
            <input type="checkbox" id="subjonctif">
            <span class="checkmark"></span>
            Subjonctif
        </label>

        <label class="time-options">
            <input type="checkbox" id="passe_recent">
            <span class="checkmark"></span>
            Passé recent
        </label>
    </div>

    <script>
        var answer;
        var popped = false;
        var startTime;
        var timerInterval;
        var verbs_arr = Object.keys(verbs);
        var width;
        var height;

        var gameContainer = document.getElementById("game-container");

        function resizeContainer() {
            width = window.innerWidth * 0.6;
            height = window.innerHeight * 0.7;
            gameContainer.style.width = width + "px";
            gameContainer.style.height = height + "px";
        }

        function addPixels(initial, pixels) {
            var nr = Number(initial.slice(0, -2)) + pixels;
            return nr + "px";
        }

        function getRandomElement(arr) {
            const randomIndex = Math.floor(Math.random() * arr.length);
            return arr[randomIndex];
        }

        function createForm(verb) {
            const personnes = ["je", "tu", "il", "nous", "vous", "ils"];
            const tempsNameArr = ["Present", "Conditionnel Present", "Conditionnel Passé", "Passé Compose", "Imparfait", "Plus-que-parfait", "Futur Simple", "Futur Proche", "Futur Antérieur", "Impératif", "Subjonctif", "Passé Recent"];
            const tempsArr = ["present", "conditionnel_present", "conditionnel_passe", "passe_compose", "imparfait", "plus_que_parfait", "futur_simple", "futur_proche", "futur_anterieur", "imperatif", "subjonctif", "passe_recent"];

            const tempsElement = document.querySelectorAll('#menu input[type="checkbox"]');
            let temps = [];
            let tempsName = [];
            tempsElement.forEach(checkbox => {
                if (checkbox.checked) {
                    temps.push(checkbox.id);
                    tempsName.push(tempsNameArr[tempsArr.indexOf(checkbox.id)]);
                }
            });

            localStorage.setItem("selection", JSON.stringify(temps));

            const p = Math.floor(Math.random() * personnes.length);
            const t = Math.floor(Math.random() * temps.length);

            if (temps[t] === "imperatif" && (p !== 1 && p !== 3 && p !== 4)) {
                return createForm(verb);
            } else {
                var konjugiertesVerb = getTemp(verb, window[temps[t]], personnes[p]);
            }
            if (temps[t] === "subjonctif") {
                if (vokale.includes(konjugiertesVerb[0])) {
                    konjugiertesVerb = "qu'" + konjugiertesVerb;
                } else {
                    konjugiertesVerb = "que " + konjugiertesVerb;
                }
            }

            var verbElement = document.createElement("div");
            verbElement.innerHTML = `${tempsName[t]} <br> ${verb.replace("_", " ")} <br> ${personnes[p]}`;
            verbElement.classList.add("balloon");
            verbElement.style.left = Math.random() * (width - 150) + 50 + "px";

            animate(verbElement);

            gameContainer.appendChild(verbElement);

            popped = false;

            answer = konjugiertesVerb;
        }

        async function check() {
            let user_answer = document.getElementById("answer").value.toLowerCase().trim();
            if (user_answer === answer) {
                document.getElementById("answer").style.backgroundColor = "lightgreen";

                setTimeout(() => {
                    document.getElementById("answer").style.backgroundColor = "white";
                    createForm(getRandomElement(verbs_arr));
                }, 150);

                document.getElementById("answer").value = "";

                popped = true;
            }
        }

        function startGame() {
            document.getElementById("menu").style = "transform: translateX(0px);";
            document.getElementById("answer").focus();
            hidePopup();
            setTimeout(() => {
                startTime = Date.now();
                timerInterval = setInterval(updateTimer, 1000); // Aktualisiert jede Sekunde
                createForm(getRandomElement(verbs_arr));
            }, 20);
        }

        function updateTimer() {
            var elapsedTime = Math.floor((Date.now() - startTime) / 1000);
            document.getElementById("timer").innerText = "Zeit: " + elapsedTime + "s";
        }

        function animate(verb) {
            var position = -100;
            var interval = setInterval(function () {
                position += ((Number(document.getElementById("timer").innerText.slice(6, -1)) / 30) + 1) / 5;
                verb.style.top = position + "px";

                if (position >= (height - 100)) {
                    clearInterval(interval);
                    verb.parentNode.removeChild(verb);
                    gameOver();
                }

                if (popped) {
                    clearInterval(interval);
                    verb.parentNode.removeChild(verb);
                }
            }, 10); // 10 ms Intervall für alle 0.2 Pixel nach unten
        }

        function gameOver() {
            clearInterval(timerInterval); // Timer stoppen
            var elapsedTime = Math.floor((Date.now() - startTime) / 1000);
            var highscore = localStorage.getItem('highscore');
            if (!highscore || elapsedTime > highscore) {
                showPopup("Neuer Highscore! Deine Zeit: " + elapsedTime + " Sekunden");
                localStorage.setItem('highscore', elapsedTime);
            } else {
                showPopup("Deine Zeit: " + elapsedTime + " Sekunden. Dein Highscore ist: <br>" + highscore + " Sekunden");
            }
        }

        function showMenu() {
            if (document.getElementById("menu").style.transform == "translateX(0px)") {
                document.getElementById("menu").style = "transform: translateX(-200px);";
            } else {
                document.getElementById("menu").style = "transform: translateX(0px);";
                var highscore = localStorage.getItem('highscore');
                showPopup("Dein Highscore ist:<br>" + highscore + " Sekunden", "Starten");
            }
        }

        window.onload = function () {
            var highscore = localStorage.getItem('highscore');

            if (!highscore) {
                showPopup("Überlebe so lange wie möglich!", "Starten");
            } else {
                showPopup("Dein Highscore ist:<br>" + highscore + " Sekunden", "Starten");
            }


            var selection = localStorage.getItem("selection");
            if (selection) {
                selection = JSON.parse(selection);
            } else {
                selection = ["present", "conditionnel_present", "conditionnel_passe", "passe_compose", "imparfait", "plus_que_parfait", "futur_simple", "futur_proche", "futur_anterieur", "imperatif", "subjonctif", "passe_recent"];
                localStorage.setItem("selection", JSON.stringify(selection));
            }

            for (let item of selection) {
                document.getElementById(item).checked = true;
            }

            document.getElementById("menu").style = "transform: translateX(0px);";
            document.getElementById("settings").style = "transform: translateX(0px);";

            resizeContainer();
        }

        window.addEventListener('resize', function() {
            resizeContainer();
        });

    </script>
</body>

</html>
